**üìå Project Skill Stack Version**

| ÏÇ¨Ïö© Í∏∞Ïà† | Î≤ÑÏ†Ñ |
| --- | --- |
| Java | OpenJDK 17 |
| SpringBoot | 3.3.4 |
| MySQL | 8.0.40 |
| Nginx | 1.27.2 |
| Nginx-rtmp | 1.23.2 |
| jenkins | **2.462.3** |
| Docker | 27.3.1 |
| ubuntu | 20.04.6 |

**üìå EC2 Ìè¨Ìä∏ Î≤àÌò∏**

| ÏÇ¨Ïö©Ï≤ò | Ìè¨Ìä∏Î≤àÌò∏ |
| --- | --- |
| Backend-server | 8082 |
| jenkins | 8080 |
| MySQL | 3306 |
| Nginx | 80/443 |
| Nginx-rtmp | 1935 |
| mqtt-server | 1883/9001 |
|  |  |

**üìå Ïô∏Î∂Ä ÌîÑÎ°úÍ∑∏Îû®**

- rtmpÎ™®ÎìàÏù¥ ÏÑ§ÏπòÎêú nginx
    - tiangolo/nginx-rtmp
- mosquittoÏÑúÎ≤Ñ Ïù¥ÎØ∏ÏßÄ
    - csh0034/mosquitto
- Í∏∞ÏÉÅÏ≤≠ ÎÇ†Ïî® API

## ÏÑúÎ≤Ñ ÏÑ§Ï†ï

- Ïä§ÌîÑÎßÅÎ∂ÄÌä∏ gradle

```java
plugins {
	id 'java'
	id 'org.springframework.boot' version '3.3.4'
	id 'io.spring.dependency-management' version '1.1.6'
}

group = 'com.ssafy.WeCanDoFarm'
version = '0.0.1-SNAPSHOT'

java {
	toolchain {
		languageVersion = JavaLanguageVersion.of(17)
	}
}

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
//	implementation 'org.springframework.boot:spring-boot-starter-data-mongodb'
	implementation 'org.springframework.boot:spring-boot-starter-data-redis'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	compileOnly 'org.projectlombok:lombok'
	developmentOnly 'org.springframework.boot:spring-boot-devtools'
	runtimeOnly 'com.mysql:mysql-connector-j'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
	testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
	// Security
	implementation 'org.springframework.boot:spring-boot-starter-security'
	testImplementation 'org.springframework.security:spring-security-test'
	implementation 'org.springframework.boot:spring-boot-starter-validation'

	// OAuth2
	implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'

	// JWT
	implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
	implementation 'io.jsonwebtoken:jjwt-impl:0.12.3'
	implementation 'io.jsonwebtoken:jjwt-jackson:0.12.3'

	//Swager
	implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.2.0'

	//S3
	implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'

	//MQTT
	implementation 'org.springframework.boot:spring-boot-starter-integration'
	implementation 'org.springframework.integration:spring-integration-mqtt'
	implementation 'org.springframework.integration:spring-integration-jmx'

	// QueryDSL
	implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
	annotationProcessor "com.querydsl:querydsl-apt:5.0.0:jakarta"
	annotationProcessor "jakarta.annotation:jakarta.annotation-api"
	annotationProcessor "jakarta.persistence:jakarta.persistence-api"
	implementation 'com.querydsl:querydsl-spatial'

	//FCM
	implementation 'com.google.firebase:firebase-admin:7.1.1'
}

tasks.named('test') {
	useJUnitPlatform()
}
```

- application.properties

```java
spring.application.name=server
spring.profiles.include=auth
#MySql
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://k11c104.p.ssafy.io:3306/WCDFarm
spring.datasource.username=root
spring.datasource.password=ssafy
#JPA
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=true
logging.level.org.hibernate.type.descriptor.sql=trace
#spring.data.redis.database=0
spring.data.redis.host=k11c104.p.ssafy.io
spring.data.redis.port=6379
spring.data.redis.password=wecandofarm
spring.jwt.access-expire=1000000000
spring.jwt.refresh-expire=1000000000
#swagger
springdoc.swagger-ui.path=/api/test
springdoc.swagger-ui.groups-order=desc
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=method
springdoc.paths-to-match=/api/v1/**
springdoc.use-fqn=true
#MQTT config
mqtt.url=tcp://k11c104.p.ssafy.io
mqtt.port=1883
mqtt.qos=2
mqtt.topic=device/#

## file size
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

```

- application-auth.properties

```java
# Secret properties
spring.jwt.secret=wecandofarmwecandofarmwecandofarmwecando
# KAKAO
spring.security.oauth2.client.provider.kakao.authorization-uri=https://kauth.kakao.com/oauth/authorize
spring.security.oauth2.client.provider.kakao.token-uri=https://kauth.kakao.com/oauth/token
spring.security.oauth2.client.provider.kakao.user-info-uri=https://kapi.kakao.com/v2/user/me
spring.security.oauth2.client.provider.kakao.user-name-attribute=kakao_account
spring.security.oauth2.client.registration.kakao.client-name=kakao
spring.security.oauth2.client.registration.kakao.client-authentication-method=client_secret_post
spring.security.oauth2.client.registration.kakao.client-id=fe01fb16b4b7baf23741e0f3c4019f13
spring.security.oauth2.client.registration.kakao.client-secret=jGSivfzyTXW01HUyX091XbQ8paYTl0xH
#spring.security.oauth2.client.registration.kakao.redirect-uri=http://localhost:8080/login/oauth2/code/kakao
spring.security.oauth2.client.registration.kakao.redirect-uri=https://k11c104.p.ssafy.io/login/oauth2/code/kakao
spring.security.oauth2.client.registration.kakao.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.kakao.scope=account_email,profile_nickname,profile_image
#spring.security.oauth2.client.registration.kakao.scope=profile_nickname,profile_image

kakao-rest-api-key=fe01fb16b4b7baf23741e0f3c4019f13
# S3
cloud.aws.credentials.accessKey=AKIAQGYBP5JBVL2C3F4L
cloud.aws.credentials.secretKey=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
cloud.aws.s3.bucketName=c207-bucket
cloud.aws.region.static=ap-southeast-2
cloud.aws.stack.auto-=false
```

- fcm ÏÑ§Ï†ïÌååÏùº (farmyo-notice.json)

```java
{
  "type": "service_account",
  "project_id": "farmyo-89acd",
  "private_key_id": "2c313adaad8d925e61d0141ef691e12936664b43",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCQ/qa8rfedhqeo\nLB6gvvFfbxBklc+eV3MRAsS7UBFLPifzB540dg3KE4+g2dxLU99lIybr87NNfz3E\nd0QukFmD+PXT//kPwJT2tkTT/cyGY0b+adV5WUHTNXYUL1t0GF0iG6nxMZsb4Twq\nGV6cukpJIb9+higyIt1vCj2VpMyCDQhw1mzVujOs+YF1SYDURIh0Su3mqO4K+uLT\nqwDcJ7ckkUClRW9kfY6RTMMEInItkxpomvGl3P5J/rWtfHOcF7b8A3m30p3KyP2D\njASQMhfY2VvwCvIK/StPn6iKfrM4XVIC4wkx92JSSorE/w7krNnQPYk/853SPG5L\n+BHn9mFFAgMBAAECggEAIjqPg57BBAXACgYiU9nHsvsN4GTyXqOv1Q31ge+oqX3a\nofeELEfLQQ9lmngb1oeOBvrpqw18oFifrQPny2NF0o8g/2Nf+U1CDUzhijcRw47n\nuVMkM1G0JadrAOBeI1XGFLF5qKgIgSgmkxyqlm6u7z1Bjt2eWxmacyZ0e+Fr6u5M\nPru3reyOREacaDt5DJEgjyLqAlxe290xSTdHMGJlwUjM++SyPKM4mINTWRtMpnFr\nM1AMx47WKbw1OS/WjA+SyKVOXiVMWhcBjr8vZsG6QbBAFa3bQSwmaN0FyuQlTK4l\n9W8d43P0wUvpwJj+u28y6GRY0bUf/epaNBoJP9H/eQKBgQDB2hKjByXIXJkWtD8o\nX4h0CkPhmk23bWZOHtIaE0PfkbW4NeUXSzp5RkYcXFQlmsWbu9VxAWsJUNdjy3Tj\nC9LXzLqZsdWLgAwB7zi7j3jO+CXq4OHdIkoFSbSCOeWVsZd+u2V7VoVSK58veWFE\nOYdrrZLyeNQDqD1YVRpHf49ZqQKBgQC/er9dDPYmW546kGUN/7AV2XEdaVHB4MOG\nn1oVh+vvcH9FjtEDb3vtCPB0qy3Qxj7iOIrgJyiyRIfXn9U98Ez3PXr4aglCGxgP\n8LGmNClcNs5sy6JFjVFCo//uDY0pRw9hxEbscRsZC4A20EfSQ8NH/lVnBuVUS1+6\ny9YnEohkPQKBgDBJpxzPGf1H+6ZpLdZbvbzSFcirzDIl4TcSfFmcdOrK/A4v9qoP\nxjgRZkOISDm5zQGXD3r/1G7UoWKteqdX+aRhzhWc88m1Esikk2g9O+WqcJ+KdxjD\ngtbAXmOWEndwboFWIthPXBR040lLHgyFnBMZgKI/sOhcTzOit1IaF1ZJAoGBAJCT\nEqgkYDqoFHltiw+dzgtBSboGSnfTyG3+JZt6LDd2vnH7mm84nt5jUIMWuJoZBWPz\ng1Ap4P1w5wx0nyKMLODE5/NmxKTIJkvq1YeDfPMmYogc3OIdCI0DnPrV+o5/G+sa\nst5VrDslxuIcMw5cobbbHwqSV1dlLduxinmn8ZmVAoGBALjyKEdf6/hdBD4EkPfX\nn10EdmzxKf7rnDQ3YppZAJd3LWJYleHLwui1lhwiIeEX1PLfKz6K88bXyYhYIe0X\nQTSOsIiYFpH53wqIlYzTGbN4EKc2Op2se/Z8MW7jOuuc8UJVGLK9Ey9XXFL4Dveg\nVH9EZujGl/Z3KdCcGLz86kNt\n-----END PRIVATE KEY-----\n",
  "client_email": "firebase-adminsdk-jl76u@farmyo-89acd.iam.gserviceaccount.com",
  "client_id": "109487126040936226987",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-jl76u%40farmyo-89acd.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}

```

- Ï†ÑÏ≤¥ ÌîÑÎ°úÏ†ùÌä∏ ÎèÑÏª§ Ïª¥Ìè¨Ï¶àÌååÏùº

```java
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: ssafy
      MYSQL_DATABASE: WCDFarm
      MYSQL_PASSWORD: ssafy
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - backendnet

  cache-database:
    image: redis:7.4-rc2-alpine
    container_name: farmyo-cache-database
    ports:
      - "6379:6379"
    entrypoint: redis-server --requirepass wecandofarm --maxmemory 128mb
    networks:
      - backendnet

  backend:
    image: backend-server
    container_name: backend-server
    ports:
      - "8082:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      - mysql
      - cache-database
    networks:
      - backendnet

  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /home/ubuntu/nginx/conf.d:/etc/nginx/conf.d
      - /etc/letsencrypt:/etc/letsencrypt
    depends_on:
      - backend
    networks:
      - backendnet

  nginx-rtmp:
    image: tiangolo/nginx-rtmp
    container_name: nginx-rtmp
    ports:
      - "1935:1935"
      - "8083:8083"
    volumes:
      - /home/ubuntu/nginx/conf.r:/etc/nginx/conf.d
      - /home/ubuntu/tmp/hls:/tmp/hls

  fastapi:
    image: parkbeomsu/ai-server:1.0
    container_name: fastapi_app
    ports:
      - "8000:8000"
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
    depends_on:
      - backend
    networks:
      - backendnet
volumes:
  mysql-data:

networks:
  backendnet:
    external: true

```

- nignx ÏÑ§Ï†ïÌååÏùº(default.conf)

```java

server{

	listen 80;
	server_name k11c104.p.ssafy.io;
	return 301 https://k11c104.p.ssafy.io$request_uri;
}
server {
    listen 443 ssl;
    server_name k11c104.p.ssafy.io;
    ssl_certificate  /etc/letsencrypt/live/k11c104.p.ssafy.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/k11c104.p.ssafy.io/privkey.pem;
    client_max_body_size 100M;	
    location / {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

- nginx-rtmp ÏÑ§Ï†ïÌååÏùº(nginx.conf) - HLSÏÑ§Ï†ï ÏûëÎèôÏù¥ ÏïàÎèºÏÑú rtmpÎ°ú ÌÜµÏã†

```java
worker_processes auto;

events {
    worker_connections 1024;
}

rtmp {
    server {
        listen 1935;  # RTMP Ìè¨Ìä∏
        chunk_size 4096;

        application live {
            live on;
            record off;

            # HLS Î≥ÄÌôò ÏÑ§Ï†ï
            hls on;
            hls_path /tmp/hls;  # HLS ÌååÏùº Ï†ÄÏû• Í≤ΩÎ°ú
            hls_fragment 5s;  # HLS Ï≤≠ÌÅ¨ Î∂ÑÌï† ÏãúÍ∞Ñ
            hls_playlist_length 30s;  # Ïû¨ÏÉù Î™©Î°ùÏùò Í∏∏Ïù¥

            # HLS ÌååÏùºÏóê Ï†ëÍ∑ºÌïòÍ∏∞ ÏúÑÌï¥ HTTP ÏÑ§Ï†ï Ï∂îÍ∞Ä
            hls_nested on;
        }
    }
}

http {
    include mime.types;
    default_type application/octet-stream;

    # HLS ÌååÏùº Ï†ëÍ∑ºÏùÑ ÏúÑÌïú HTTP ÏÑúÎ≤Ñ ÏÑ§Ï†ï
    server {
        listen 8083;  # HLS Ïä§Ìä∏Î¶º ÏöîÏ≤≠ Ìè¨Ìä∏ (Ïòà: 8080)
        server_name k11c104.p.ssafy.io;
	
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root /tmp;  # HLS ÌååÏùº Í≤ΩÎ°ú ÏÑ§Ï†ï
            add_header Cache-Control no-cache;

            # CORS Ìó§Îçî Ï∂îÍ∞Ä
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept, Authorization';
        }
    }
}
```

- Ï††ÌÇ®Ïä§ ÌååÏù¥ÌîÑÎùºÏù∏ÏΩîÎìú

```java
pipeline {
    agent any

    environment {
        BACKEND_DIR = './server'
        DOCKER_IMAGE_BACKEND = 'backend-server'
        CONFIG_FILE_PATH = '/home/backend_config/application.properties'
        AUTH_CONFIG_FILEL_PATH = '/home/backend_config/application-auth.properties'
        TARGET_DIR = 'server/src/main/resources/'
        GITLAB_CREDENTIALSID = 'sdi4676'
        PROJECT_DOCKER_COMPOSE_PATH = '/home/backend_config/docker-compose.yml'
        PROJECT_FCM_CONFIG_PATH = '/home/backend_config/farmyo-notice.json'
    
    }

    stages {
        
        
        stage('Checkout') {
            steps {
                git credentialsId: GITLAB_CREDENTIALSID, branch: 'master', url: 'https://lab.ssafy.com/s11-final/S11P31C104.git'
            }
        }
        stage('Notify Start') {
            steps {
                script {
                    def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                    def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                    mattermostSend(
                        color: 'warning',
                        message: "ÎπåÎìú ÏãúÏûë: ${env.JOB_NAME} #${env.BUILD_NUMBER} \n(<${env.BUILD_URL}|Details>)",
                        endpoint: 'https://meeting.ssafy.com/hooks/k14r9wx7obbqmg4np6hx6amxdh',
                        channel: 'c104_jenkins'
                    )
                }
            }
        }
        
        stage('Copy config files') {
            steps {
                script {
                    def workspaceDir = pwd()
                    sh "cp ${CONFIG_FILE_PATH} ${workspaceDir}/${TARGET_DIR}"
                    sh "cp ${AUTH_CONFIG_FILEL_PATH} ${workspaceDir}/${TARGET_DIR}"
                    sh "cp ${PROJECT_FCM_CONFIG_PATH} ${workspaceDir}/${TARGET_DIR}"
                    sh "cp ${PROJECT_DOCKER_COMPOSE_PATH} ${workspaceDir}"
                }
            }
        }

        stage('Build Backend') {
            steps {
                dir(BACKEND_DIR) {
                    sh 'chmod +x gradlew'
                    sh './gradlew clean build'
                }
            }
        }

        stage('Docker Build') {
            parallel {
                stage('Docker Build Backend') {
                    steps {
                        dir(BACKEND_DIR) {
                            script {
                                docker.build(DOCKER_IMAGE_BACKEND)
                            }
                        }
                    }
                }

            }
        }

        stage('Deploy') {
            steps {
                script {
                    if (fileExists('docker-compose.yml')) {
                        sh 'docker-compose down'

                        sh 'docker-compose up -d'
                    } else {
                        error "docker-compose.yml ÌååÏùºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§."
                    }
                }
            }
        }
    }
    post {
        success {
            script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend(color: 'good',
                    message: "ÎπåÎìú ÏÑ±Í≥µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}\n(<${env.BUILD_URL}|Details>)",
                    endpoint: 'https://meeting.ssafy.com/hooks/k14r9wx7obbqmg4np6hx6amxdh',
                    channel: 'c104_jenkins'
                )
            }
        }
        failure {
            script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend(color: 'danger',
                    message: "ÎπåÎìú Ïã§Ìå®: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}\n(<${env.BUILD_URL}|Details>)",
                    endpoint: 'https://meeting.ssafy.com/hooks/k14r9wx7obbqmg4np6hx6amxdh',
                    channel: 'c104_jenkins'
                )
            }
        }
    }
}

```

## Î∞∞Ìè¨ ÌäπÏù¥ÏÇ¨Ìï≠

- ÎèÑÏª§ÏÑ§Ïπò
    - docker docsÏ∞∏Í≥† https://docs.docker.com/engine/install/ubuntu/
    1. Set up Docker's¬†`apt`¬†repository.
        
        `# Add Docker's official GPG key:
        sudo apt-get update
        sudo apt-get install ca-certificates curl
        sudo install -m 0755 -d /etc/apt/keyrings
        sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
        sudo chmod a+r /etc/apt/keyrings/docker.asc
        
        # Add the repository to Apt sources:
        echo \
          "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
          $(. /etc/os-release && echo "$VERSION_CODENAME")„Öõ stable" | \
          sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
        sudo apt-get update`
        
        > Note
        > 
        > 
        > If you use an Ubuntu derivative distro, such as Linux Mint, you may need to use¬†`UBUNTU_CODENAME`¬†instead of¬†`VERSION_CODENAME`.
        > 
    2. Install the Docker packages.
        
        Latest¬†Specific version
        
        ---
        
        To install the latest version, run:
        
        `$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin`
        
        ---
        
    3. Verify that the Docker Engine installation is successful by running the¬†`hello-world`¬†image.
        
        `$ sudo docker run hello-world`
        
        This command downloads a test image and runs it in a container. When the container runs, it prints a confirmation message and exits.
        
- SSLÏù∏Ï¶ù
    
    ```java
    sudo apt install certbot
    sudo certbot certonly --standalone -d {ÎèÑÎ©îÏù∏ Ï£ºÏÜå}
    sudo certbot certificates
    ```
    
- ÎèÑÏª§Í∞Ä ÏÑ§ÏπòÎêú Ï††ÌÇ®Ïä§ Ïù¥ÎØ∏ÏßÄÎ•º ÏúÑÌïú ÎèÑÏª§ÌååÏùº

```java
# Î≤†Ïù¥Ïä§ Jenkins LTS Ïù¥ÎØ∏ÏßÄ
FROM jenkins/jenkins:lts

# root ÏÇ¨Ïö©ÏûêÎ°ú Ï†ÑÌôò
USER root

# Docker ÏÑ§Ïπò
RUN apt-get update && \
    apt-get install -y apt-transport-https ca-certificates curl software-properties-common && \
    curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - && \
    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable" && \
    apt-get update && \
    apt-get install -y docker-ce

# Docker Compose ÏÑ§Ïπò
RUN curl -L "https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose && \
    chmod +x /usr/local/bin/docker-compose && \
    ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose

# Jenkins ÏÇ¨Ïö©ÏûêÎ°ú ÎêòÎèåÎ¶º
USER jenkins

```

- docker-compose ÏÑ§Ïπò

```java
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
```

- Ai-server image pull

# ÏãúÏó∞ ÏãúÎÇòÎ¶¨Ïò§